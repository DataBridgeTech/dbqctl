version: "1"
validations:
  # https://clickhouse.com/docs/getting-started/example-datasets/nyc-taxi
  - dataset: ch@[nyc_taxi.trips_small]
    # common pre-filter for every check, e.g. to run daily check only for yesterday
    where: "pickup_datetime > '2014-01-01'"
    checks:
      - id: row_count > 0
        description: "data should be present" # optional
        on_fail: error # optional (error, warn), default "error"

      - id: row_count between 100 and 30000
        description: "expected rows count"
        on_fail: warn

      - id: null_count(pickup_ntaname) == 0
        description: "no nulls are allowed in column: pickup_ntaname"

      - id: min(pickup_datetime) < now() - interval 3 day
        description: "min(pickup_datetime) should not be earlier than 3 days"

      - id: stddevPop(trip_distance) < 100_000
        description: "check stddev value"

      - id: sum(fare_amount) <= 10_000_000
        description: "sum of value"

      - id: countIf(trip_id == 1) == 1
        description: "check trip id"

      - id: raw_query
        description: "raw query quality test"
        query: |
          select countIf(trip_distance == 0) > 0 from {{table}} where 1=1

  # https://wiki.postgresql.org/wiki/Sample_Databases
  - dataset: pg@[public.land_registry_price_paid_uk]
    # exclude January for example
    where: "transfer_date >= '2025-02-01 00:00:00.000000'"
    checks:
      - id: row_count > 0
        description: "data should be present"
        on_fail: error

      - id: row_count between 200000 and 300000
        description: "expected rows count"
        on_fail: warn

      - id: min(price) > 0
        description: "min(price) should be greater than zero"

      - id: max(price) < 100000000
        description: "max(price) should be less than 100_000_000"

      - id: stddev_pop(price) < 500000
        description: "price stddev"

  # https://github.com/datacharmer/test_db
  - dataset: mysql@[employees.salaries]
    checks:
      - id: row_count > 0
        description: "data should be present"
        on_fail: error

      - id: min(salary) > 0
        description: "min(salary) should be greater than zero"

      - id: max(salary) < 150000
        description: "max(salary) should be less than 150000"

      - id: stddev_pop(salary) < 50000
        description: "price stddev"